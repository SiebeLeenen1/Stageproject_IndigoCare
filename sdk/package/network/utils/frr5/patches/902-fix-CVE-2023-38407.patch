Index: frr-5.0.2/bgpd/bgp_label.c
===================================================================
--- frr-5.0.2.orig/bgpd/bgp_label.c
+++ frr-5.0.2/bgpd/bgp_label.c
@@ -172,6 +172,9 @@ static int bgp_nlri_get_labels(struct pe
 	uint8_t llen = 0;
 	uint8_t label_depth = 0;
 
+	if (plen < BGP_LABEL_BYTES)
+		return 0;
+
 	for (; data < lim; data += BGP_LABEL_BYTES) {
 		memcpy(label, data, BGP_LABEL_BYTES);
 		llen += BGP_LABEL_BYTES;
@@ -235,6 +238,9 @@ int bgp_nlri_parse_label(struct peer *pe
 
 			addpath_id = ntohl(*((uint32_t *)pnt));
 			pnt += BGP_ADDPATH_ID_LEN;
+
+			if (pnt >= lim)
+				return -1;
 		}
 
 		/* Fetch prefix length. */
@@ -254,6 +260,14 @@ int bgp_nlri_parse_label(struct peer *pe
 		llen = bgp_nlri_get_labels(peer, pnt, psize, &label);
 		p.prefixlen = prefixlen - BSIZE(llen);
 
+		if (llen == 0) {
+			zlog_err("%s [Error] Update packet error (wrong label length 0)",
+			peer->host);
+			bgp_notify_send(peer, BGP_NOTIFY_UPDATE_ERR,
+					BGP_NOTIFY_UPDATE_INVAL_NETWORK);
+			return -1;
+		}
+
 		/* There needs to be at least one label */
 		if (prefixlen < 24) {
 			zlog_err(
