#!/bin/sh

setup_ath10k_caldata() {
	[ -e /proc/device-tree/ahb/pcie-controller@180c0000/wifi@0,0 ] || return

	local board
	if [ -e /tmp/sysinfo ]; then
		board=$(cat /tmp/sysinfo/board_name)
	else
		board=$(strings /proc/device-tree/compatible | head -n1)
	fi

	. /lib/functions/caldata.sh

	case $board in
	teltonika,tcr1xx)
		echo "- extracting ath10k calibration data -"
		mkdir -p /var/ath10k
		caldata_extract "art" 0x5000 0x844 "/var/ath10k/cal-pci-0000:00:00.0.bin"
		;;
	esac
}

boot_hook_add preinit_main setup_ath10k_caldata
